{"version":3,"sources":["../src/index.js"],"names":["DEFAULT_CONFIG","width","height","rectHeight","intervalTime","baseColors","Histogram","colors","dataList","dataIndex","currentData","data","d3","csvParse","mock","init","start","margin","left","right","top","bottom","innerWidth","innerHeight","svg","select","append","attr","g","xAxisG","yAxisG","xScale","scaleLinear","yScale","scaleBand","paddingInner","paddingOuter","xAxis","axisBottom","scale","ticks","tickPadding","tickFormat","d","tickSize","yAxis","axisLeft","initColorAndDate","index","forEach","item","dateList","indexOf","date","push","name","undefined","length","value","sort","xMin","min","xValue","xMax","max","domain","range","map","e","reverse","transition","duration","interval_time","ease","easeLinear","call","selectAll","remove","bar","barEnter","enter","yValue","delay","barUpdate","dateIndex","getCurrentData","drawHistogram","changeHistogram"],"mappings":"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","sourcesContent":["/**\n * @file 动态柱状图实现\n * @author sikazhang\n * @date 2019-12-07\n */\nimport mock from './mock.csv';\nimport d3 from 'd3.js';\n// 支持自定义配置项\nconst DEFAULT_CONFIG = {\n    width: 1800,\n    height: 800,\n    rectHeight: 26,\n    intervalTime: 0.5,\n    baseColors: [\n        '#FFB6C1', '#2EA9DF', '#C71585', '#FFC012', '#7B68EE', '#0000CD', '#000080',\n        '#87CEFA', '#DC143C', '#39C5BB', '#009714', '#FFD700', '#FFA500', '#FF8C00'\n    ]\n};\n\n/**\n * 柱状图组件\n * @param {object} config\n */\nexport default class Histogram {\n    constructor() {\n        this.colors = [];\n        this.dataList = [];\n        this.dataIndex = 0;\n        this.currentData = [];\n        this.data = d3.csvParse(mock);\n        this.init();\n        this.start();\n    }\n    init() {\n        // 定义布局变量\n        const margin = {left: 250, right: 150, top: 20, bottom: 0};\n        const innerWidth = DEFAULT_CONFIG.width - margin.left - margin.right;\n        const innerHeight = DEFAULT_CONFIG.height - margin.top - margin.bottom;\n        // 画布\n        const svg = d3.select('#container')\n            .append('svg')\n            .attr('width', DEFAULT_CONFIG.width)\n            .attr('height', DEFAULT_CONFIG.height);\n        this.g = svg.append('g')\n            .attr('transform', `translate(${margin.left}, ${margin.top})`);\n        this.xAxisG = this.g.append('g')\n            .attr('transform', `translate(0,${innerHeight})`);\n        this.yAxisG = this.g.append('g');\n        // 比例尺\n        this.xScale = d3.scaleLinear();\n        this.yScale = d3.scaleBand().paddingInner(0.3).paddingOuter(0);\n        // 轴\n        this.xAxis = d3.axisBottom()\n            .scale(this.xScale)\n            .ticks(10)\n            .tickPadding(20)\n            .tickFormat(d=>{\n                return d < 0 ? '' : d;\n            })\n            .tickSize(-innerHeight);\n        this.yAxis = d3.axisLeft()\n            .scale(this.yScale)\n            .tickPadding(5)\n            .tickSize(-innerWidth);\n        // 右下角时间指示器\n        this.g.append('text')\n            .attr('class', 'dateLabel')\n            .attr('text-anchor', 'end')\n            .attr('transform', `translate(${innerWidth - 10},${innerHeight - 10})`);\n        this.initColorAndDate();\n    }\n    initColorAndDate() {\n        let index = 0;\n        this.data.forEach(item => {\n            if (this.dateList.indexOf(item.date) === -1) {\n                this.dateList.push(item.date);\n            }\n\n            if (this.colors[item.name] === undefined) {\n                this.colors[item.name] = DEFAULT_CONFIG.baseColors[index % DEFAULT_CONFIG.baseColors.length];\n                index++;\n            }\n        });\n    }\n    getCurrentData(date) {\n        this.currentData = [];\n        this.data.forEach(item => {\n            if (item.date === date && +item.value > 0) {\n                this.currentData.push(item);\n            }\n        });\n\n        this.currentData.sort();\n\n    }\n    drawHistogram() {\n        let xMin = d3.min(this.currentData, this.xValue);\n        let xMax = d3.max(this.currentData, this.xValue);\n        this.xScale.domain([0, xMax + 1]).range([0, innerWidth]);\n        this.yScale.domain(this.currentData\n            .map(e => e.name)\n            .reverse()\n            .range([innerHeight, 0]));\n\n        this.xAxisG.transition()\n            .duration(3000 * DEFAULT_CONFIG.interval_time)\n            .ease(d3.easeLinear)\n            .call(this.xAxis);\n        this.yAxisG.transition()\n            .duration(3000 * DEFAULT_CONFIG.interval_time)\n            .ease(d3.easeLinear)\n            .call(this.yAxis);\n        this.yAxisG.selectAll('.tick').remove();\n\n        // 选中所有bar并绑定数据（指定key函数）\n        let bar = this.g.selectAll('.bar').data(this.currentData, e => e.name);\n        // enter，起始动画\n        let barEnter = bar.enter()\n            .append('g')\n            .attr('class', 'bar')\n            .attr('transform', function (d) {\n                return 'translate(0, ' + this.yScale(this.yValue(d)) + ')';\n            });\n        // 矩形\n        barEnter.append('rect')\n            .attr('x', 0)\n            .attr('y', 50)\n            .attr('width', 0)\n            .attr('height', DEFAULT_CONFIG.rectHeight)\n            .attr('fill-opacity', 0)\n            .attr('fill', d=>this.colors[d.name])\n            .transition()\n            .delay(500 * DEFAULT_CONFIG.interval_time)\n            .duration(2490 * DEFAULT_CONFIG.interval_time)\n            .attr('y', 0)\n            .attr('width', d => this.xScale(d.value))\n            .attr('fill-opacity', 1);\n        // update（更新动态）,有可能是全新的一套数据，但是bar的位置已经确定，只需要更改颜色和样式即可\n        let barUpdate = bar.transition().duration(2950 * DEFAULT_CONFIG.interval_time).ease(d3.easeLinear);\n        barUpdate.select('rect')\n            .attr('width', d => this.xScale(d.value))\n            .attr('fill', d => this.colors[d.name]);\n    }\n    changeHistogram() {\n        this.g.selectAll('.bar')\n            .transition()\n            .ease(d3.easeLinear)\n            .duration(3000 * DEFAULT_CONFIG.intervalTime)\n            .attr('transform', function (d) {\n                return 'translate(0,' + this.yScale(this.yValue(d)) + ')';\n            });\n    }\n    start() {\n        if (this.dateIndex < this.dateList.length) {\n            this.getCurrentData(this.dateList[this.dateIndex]);\n            this.drawHistogram();\n            this.changeHistogram();\n            this.dateIndex++;\n        }\n    }\n    xValue(e) {\n        return +e.value;\n    }\n    yValue(e) {\n        return e.name;\n    }\n}\n\n"],"file":"index.js"}